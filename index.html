<!DOCTYPE html>
<html ng-app>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        
        <link rel="stylesheet" href="https://cdn.rawgit.com/mistic100/Photo-Sphere-Viewer/master/dist/photo-sphere-viewer.min.css" />
        
        <link rel="stylesheet" href="css/stylesheet.css" />
        <script src="https://cdn.rawgit.com/malko/D.js/master/lib/D.min.js"></script>
        <script src="https://cdn.rawgit.com/mrdoob/three.js/master/build/three.js"></script>
<!--        <script src="js/three.js"></script>-->
        <!--[if IE]>
        <script src="https://cdn.rawgit.com/mrdoob/three.js/master/examples/js/renderers/CanvasRenderer.js"></script>
        <script src="https://cdn.rawgit.com/mrdoob/three.js/master/examples/js/renderers/Projector.js"></script>
        <!--[endif]-->
        <script src="https://cdn.rawgit.com/mrdoob/three.js/master/examples/js/postprocessing/EffectComposer.js"></script>
        <script src="https://cdn.rawgit.com/mrdoob/three.js/master/examples/js/postprocessing/RenderPass.js"></script>
        <script src="https://cdn.rawgit.com/mrdoob/three.js/master/examples/js/postprocessing/ShaderPass.js"></script>
        <script src="https://cdn.rawgit.com/mrdoob/three.js/master/examples/js/postprocessing/MaskPass.js"></script>
        <script src="https://cdn.rawgit.com/mrdoob/three.js/master/examples/js/shaders/CopyShader.js"></script>
        <script src="https://cdn.rawgit.com/mrdoob/three.js/master/examples/js/controls/DeviceOrientationControls.js"></script>
        <script src="https://cdn.rawgit.com/mistic100/Photo-Sphere-Viewer/master/dist/photo-sphere-viewer.js"></script>
        
<!--
        <script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
        <script src="http://code.jquery.com/jquery-1.12.1.min.js"></script>
-->
        
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.0/angular.min.js"></script>
        <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.0/angular-route.js"></script>
        
<!--        <script src="app.js"></script>-->
        
        <style>
            html, body {
                width: 100%;
                height: 100%;
                overflow: hidden;
                margin: 0;
                padding: 0;
            }
            
            #photosphere {
                width: 100%;
                height: 100%;
            }
            
            .psv-button.custom-button {
                font-size: 18px;
            }
        </style>
    </head>
    <body>
        <div id="photosphere"></div>
        <script>
            var container = document.querySelector("#photosphere");
            
            function showPopup(markerID) {
                return function() {
                    viewer.hud.psv.trigger('select-marker', viewer.getMarker(markerID));

                    if(window.innerWidth / window.innerHeight >= 1) {
                        var markerLat = currentPos.latitude;
                        var markerLong = currentPos.longitude - Math.PI / 8;
                    } else {
                        console.log("vertical case");
                        var markerLat = currentPos.latitude + Math.PI / 8;
                        var markerLong = currentPos.longitude;
                    }

                    viewer.updateMarker({
                        id: markerID,
                        latitude: markerLat,
                        longitude: markerLong,
                        visible: true
                    });

                    setTimeout(function(){
                        viewer.showPanel(viewer.getMarker(markerID).content);
                    }, 500);
                }
            }
            
            var viewer = PhotoSphereViewer({
                container: container,
                panorama: 'image/farm/farm_bright_04.jpeg',
                markers: (function() {
                    var a = [];
                    a.push({
                        id: 'first-polygon',
                        polygon_rad: [Math.PI*11/12,0, Math.PI/12,0, 0,Math.PI/6],
                        style: {
                            fill: "rgba(255, 255, 0, 0.4)",
                            stroke: "none"
                        },
                        content: "This is panel content"
                    });
                    
                    a.push({
                        id: 'waterTemp',
                        html: '수온 마커',
                        content: '<div><img src="http://52.79.130.102:8888/waterTemp.png" /></div>hidden panel content',
                        latitude: 0,
                        longitude: 0,
                        className: 'popup',
                        visible: false
                    });
                    
                    a.push({
                        id: 'visibleLight',
                        html: '가시광선 마커',
                        content: '<div><img src="http://52.79.130.102:8888/visibleLight.png" /></div>hidden panel content',
                        latitude: 0,
                        longitude: 0,
                        className: 'popup',
                        visible: false
                    });
                    
                    a.push({
                        id: 'DO',
                        html: '용존산소량 마커',
                        content: '<div><img src="http://52.79.130.102:8888/DO.png" /></div>hidden panel content',
                        latitude: 0,
                        longitude: 0,
                        className: 'popup',
                        visible: false
                    });
                    
                    a.push({
                        id: 'airTemp',
                        html: '기온 마커',
                        content: '<div><img src="http://52.79.130.102:8888/airTemp.png" /></div>hidden panel content',
                        latitude: 0,
                        longitude: 0,
                        className: 'popup',
                        visible: false
                    });
                    
                    return a;
                }()),
                caption: 'FarmView &copy <img src="image/gnb_logo_white.png" />',
                navbar: [
                    'autorotate', 'zoom',
                    {
                        title: 'Water temperature',
                        className: 'custom-button',
                        content: '수온',
                        onClick: showPopup('waterTemp')
                    },
                    {
                        title: 'Visible light',
                        className: 'custom-button',
                        content: '햇빛',
                        onClick: showPopup('visibleLight')
                    },
                    {
                        title: 'DO',
                        className: 'custom-button',
                        content: 'DO',
                        onClick: showPopup('DO')
                    },
                    {
                        title: 'Air temperature',
                        className: 'custom-button',
                        content: '기온',
                        onClick: showPopup('airTemp')
                    },
                    'caption', 'gyroscope', 'fullscreen'
                ]
            });
            
            var popupMarkers = [];
            
            var currentPos = {
                longitude: new Number(),
                latitude: new Number()
            };
            
            viewer.on('ready', function() {
                currentPos.longitude = viewer.config.longitude !== undefined ? viewer.config.longitude : viewer.config.default_long;
                currentPos.latitude = viewer.config.latitude !== undefined ? viewer.config.latitude : viewer.config.default_lat;
                
                popupMarkers = Object.keys(viewer.hud.markers).filter(function(element) {
                    var currentMarker = viewer.getMarker(element);
                    if(currentMarker.className && currentMarker.className.match(/popup/)) {
                        return true;
                    } else {
                        return false;
                    }
                });
            });
            
            viewer.on('position-updated', function(pos) {
                currentPos = pos;
            });
            
            viewer.on('close-panel', function() {
                viewer.hud.psv.trigger('unselect-marker');
            });
            
            viewer.on('unselect-marker', function() {
                popupMarkers.forEach(function(element) {
                    viewer.updateMarker({
                        id: element,
                        visible: false
                    });
                });
            });
        </script>
    </body>
</html>